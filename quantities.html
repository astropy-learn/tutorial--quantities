
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Using Astropy Quantities and Units for astrophysical calculations &#8212; Quantities</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-ZBXC3EFGGJ"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-ZBXC3EFGGJ');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-ZBXC3EFGGJ');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'quantities';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
     
  

<a class="navbar-brand logo" href="https://learn.astropy.org">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.svg" class="logo__image only-light" alt="Learn Astropy"/>
    <script>document.write(`<img src="_static/logo.svg" class="logo__image only-dark" alt="Learn Astropy"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/astropy-learn/tutorial--quantities" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/astropy-learn/tutorial--quantities/edit/main/quantities.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/astropy-learn/tutorial--quantities/issues/new?title=Issue%20on%20page%20%2Fquantities.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/quantities.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Using Astropy Quantities and Units for astrophysical calculations</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#authors">Authors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#keywords">Keywords</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#companion-content">Companion Content</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preliminaries">Preliminaries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#galaxy-mass">1. Galaxy mass</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#molecular-cloud-mass">2. Molecular cloud mass</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-the-data-cube">Setting up the data cube</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#measuring-the-column-density-of-co">Measuring The Column Density of CO</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#co-to-total-mass">CO to Total Mass</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Exercises</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-quantities-with-functions">3. Using Quantities with Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">Exercise</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="using-astropy-quantities-and-units-for-astrophysical-calculations">
<h1>Using Astropy Quantities and Units for astrophysical calculations<a class="headerlink" href="#using-astropy-quantities-and-units-for-astrophysical-calculations" title="Link to this heading">#</a></h1>
<section id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Link to this heading">#</a></h2>
<p>Ana Bonaca, Erik Tollerud, Jonathan Foster, Lia Corrales, Kris Stern, Stephanie T. Douglas</p>
</section>
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects to estimate a hypothetical galaxy’s mass</p></li>
<li><p>Take advantage of constants in the <code class="docutils literal notranslate"><span class="pre">astropy.constants</span></code> library</p></li>
<li><p>Print formatted unit strings</p></li>
<li><p>Plot <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects with unit labels, using <code class="docutils literal notranslate"><span class="pre">astropy.visualization.quantity_support</span></code></p></li>
<li><p>Do math with <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects</p></li>
<li><p>Convert quantities with <code class="docutils literal notranslate"><span class="pre">astropy.units</span></code></p></li>
<li><p>Convert between wavelength and energy with <code class="docutils literal notranslate"><span class="pre">astropy.units.spectral</span></code> equivalencies</p></li>
<li><p>Use the small angle approximation with <code class="docutils literal notranslate"><span class="pre">astropy.units.dimensionless_angles</span></code> equivalencies</p></li>
<li><p>Write functions that take <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects instead of numpy arrays</p></li>
<li><p>Make synthetic radio observations</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects such as data cubes to facilitate a full derivation of the total mass of a molecular cloud</p></li>
</ul>
</section>
<section id="keywords">
<h2>Keywords<a class="headerlink" href="#keywords" title="Link to this heading">#</a></h2>
<p>units, radio astronomy, data cubes, matplotlib</p>
</section>
<section id="companion-content">
<h2>Companion Content<a class="headerlink" href="#companion-content" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="https://www.springer.com/gp/book/9783662053942">Tools for Radio Astronomy</a> by Rohlfs &amp; Wilson</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>In this tutorial we present some examples showing how Astropy’s <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> object can make astrophysics calculations easier. The examples include calculating the mass of a galaxy from its velocity dispersion and determining masses of molecular clouds from CO intensity maps. We end with an example of good practices for using quantities in functions you might distribute to other people.</p>
<p>For an in-depth discussion of <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects, see the <a class="reference external" href="http://docs.astropy.org/en/stable/units/quantity.html">astropy documentation section</a>.</p>
</section>
<section id="preliminaries">
<h2>Preliminaries<a class="headerlink" href="#preliminaries" title="Link to this heading">#</a></h2>
<p>We start by loading standard libraries and set up plotting for ipython notebooks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># You shouldn&#39;t use the `seed` function in real science code, but we use it here for example purposes.</span>
<span class="c1"># It makes the &quot;random&quot; number generator always give the same numbers wherever you run it.</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>

<span class="c1"># Set up matplotlib</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<p>It’s conventional to load the Astropy <code class="docutils literal notranslate"><span class="pre">units</span></code> module as the variable  <code class="docutils literal notranslate"><span class="pre">u</span></code>, demonstrated below.  This will make working with <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects much easier.</p>
<p>Astropy also has a <code class="docutils literal notranslate"><span class="pre">constants</span></code> module where typical physical constants are available.  The constants are stored as objects of a subclass of <code class="docutils literal notranslate"><span class="pre">Quantity</span></code>, so they behave just like a <code class="docutils literal notranslate"><span class="pre">Quantity</span></code>. Here, we’ll only need the gravitational constant <code class="docutils literal notranslate"><span class="pre">G</span></code>, Planck’s constant <code class="docutils literal notranslate"><span class="pre">h</span></code>, and Boltzmann’s constant, <code class="docutils literal notranslate"><span class="pre">k_B</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">astropy.units</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">u</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">G</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k_B</span>
</pre></div>
</div>
</div>
</div>
<p>We will also show an example of plotting while taking advantage of the <code class="docutils literal notranslate"><span class="pre">astropy.visualization</span></code> package, which provides support for <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> units.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">astropy.visualization</span><span class="w"> </span><span class="kn">import</span> <span class="n">quantity_support</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="galaxy-mass">
<h2>1. Galaxy mass<a class="headerlink" href="#galaxy-mass" title="Link to this heading">#</a></h2>
<p>In this first example, we will use <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects to estimate a hypothetical galaxy’s mass, given its half-light radius and radial velocities of stars in the galaxy.</p>
<p>Let’s assume that we measured the half-light radius of the galaxy to be 29 pc projected on the sky at the distance of the galaxy. This radius is often called the “effective radius”, so we’ll store it as a <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> object with the name <code class="docutils literal notranslate"><span class="pre">Reff</span></code>. The easiest way to create a <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> object is by multiplying the value with its unit. Units are accessed as u.”unit”, in this case u.pc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Reff</span> <span class="o">=</span> <span class="mi">29</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pc</span>
</pre></div>
</div>
</div>
</div>
<p>A completely equivalent (but more verbose) way of doing the same thing is to use the <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> object’s initializer, demonstrated below.  In general, the simpler form (above) is preferred, as it is closer to how such a quantity would actually be written in text.  The initalizer form has more options, though, which you can learn about from the <a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.units.quantity.Quantity.html">astropy reference documentation on Quantity</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Reff</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">(</span><span class="mi">29</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can access the value and unit of a <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> using the <code class="docutils literal notranslate"><span class="pre">value</span></code> and <code class="docutils literal notranslate"><span class="pre">unit</span></code> attributes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Half light radius</span>
<span class="sd">value: {0}</span>
<span class="sd">unit: {1}&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Reff</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">Reff</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Half light radius
value: 29.0
unit: pc
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">value</span></code> and <code class="docutils literal notranslate"><span class="pre">unit</span></code> attributes can also be accessed within the print function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Half light radius</span>
<span class="sd">value: {0.value}</span>
<span class="sd">unit: {0.unit}&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Reff</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Half light radius
value: 29.0
unit: pc
</pre></div>
</div>
</div>
</div>
<p>Furthermore, we can convert the radius in parsecs to any other unit of length using the <code class="docutils literal notranslate"><span class="pre">to()</span></code> method. Here, we convert it to meters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:.3g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Reff</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8.95e+17 m
</pre></div>
</div>
</div>
</div>
<p>Next, we’ll first create a synthetic dataset of radial velocity measurements, assuming a normal distribution with a mean velocity of 206 km/s and a velocity dispersion of 4.3 km/s.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vmean</span> <span class="o">=</span> <span class="mi">206</span>
<span class="n">sigin</span> <span class="o">=</span> <span class="mf">4.3</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">vmean</span><span class="p">,</span> <span class="n">sigin</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;First 10 radial velocity measurements: </span>
<span class="sd">{0}</span>
<span class="sd">{1}&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">m</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)[:</span><span class="mi">10</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>First 10 radial velocity measurements: 
[205.11975706 208.05945635 203.76641353 203.61035969 214.45285646
 211.99164508 206.39950387 207.21150846 209.30679704 211.35966937] km / s
[205119.75706422 208059.45635365 203766.41352526 203610.35969131
 214452.85646176 211991.64508178 206399.50387    207211.50845717
 209306.79704073 211359.66936646] m / s
</pre></div>
</div>
</div>
</div>
<p>One can ocassionally run into issues when attempting to plot <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects with <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> libraries. It is always possible to fix this by passing the value array (e.g., <code class="docutils literal notranslate"><span class="pre">v.value</span></code>) to <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> functions. However, calling the <code class="docutils literal notranslate"><span class="pre">astropy.visualization.quantity_support()</span></code> function will change the settings on your <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> session to better handle astropy <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quantity_support</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;astropy.visualization.units.quantity_support.&lt;locals&gt;.MplQuantityConverter at 0x7f2f5c82f380&gt;
</pre></div>
</div>
</div>
</div>
<p>Now we can plot a histogram of the velocity dataset. Note that, due to calling <code class="docutils literal notranslate"><span class="pre">quantity_support</span></code>, the x-axis is automatically labeled with the correct units.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;N&#39;)
</pre></div>
</div>
<img alt="_images/6ebd1928a673baf46e259efe553a5d8c57cf12c847b4fe9ec16a7a85068f3071.png" src="_images/6ebd1928a673baf46e259efe553a5d8c57cf12c847b4fe9ec16a7a85068f3071.png" />
</div>
</div>
<p>Now we can calculate the velocity dispersion of the galaxy. This demonstrates how you can perform basic operations like subtraction and division with <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects, and also use them in standard numpy functions such as <code class="docutils literal notranslate"><span class="pre">mean()</span></code> and <code class="docutils literal notranslate"><span class="pre">size()</span></code>. They retain their units through these operations just as you would expect them to.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">v</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Velocity dispersion: </span><span class="si">{0:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Velocity dispersion: 4.36 km / s
</pre></div>
</div>
</div>
</div>
<p>Note how we needed to use <code class="docutils literal notranslate"><span class="pre">numpy</span></code> square root function, because the resulting velocity dispersion quantity is a <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array. If we used the python standard <code class="docutils literal notranslate"><span class="pre">math</span></code> library’s <code class="docutils literal notranslate"><span class="pre">sqrt</span></code> function instead, we get an error.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sigma_scalar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">v</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>In general, you should only use <code class="docutils literal notranslate"><span class="pre">numpy</span></code> functions with <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects, <em>not</em> the <code class="docutils literal notranslate"><span class="pre">math</span></code> equivalents, unless you are sure you understand the consequences.</p>
<p>Now for the actual mass calculation.  If a galaxy is pressure-supported (for example, an elliptical or dwarf spheroidal galaxy), its mass within the stellar extent can be estimated using a straightforward formula: <span class="math notranslate nohighlight">\(M_{1/2}=4\sigma^2 R_{eff}/G\)</span>.  There are caveats to the use of this formula for science – see Wolf et al. 2010 for details.  For demonstrating <code class="docutils literal notranslate"><span class="pre">Quantity</span></code>, you can accept that this is often good enough. For the calculation, we can multiply the quantities together, and <code class="docutils literal notranslate"><span class="pre">astropy</span></code> will keep track of the units.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Reff</span> <span class="o">/</span> <span class="n">G</span>
<span class="n">M</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[3.3084841 \times 10^{13} \; \mathrm{\frac{km^{2}\,kg\,pc}{m^{3}}}\]</div>
</div>
</div>
<p>The result is in a composite unit, so it’s not really obvious it’s a mass. However, it can be decomposed to cancel all of the length units (<span class="math notranslate nohighlight">\(km^2 pc/m^3\)</span>) using the <code class="docutils literal notranslate"><span class="pre">decompose()</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">M</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[1.0208915 \times 10^{36} \; \mathrm{kg}\]</div>
</div>
</div>
<p>We can also easily express the mass in whatever form you like – solar masses are common in astronomy, or maybe you want the default SI and CGS units.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Galaxy mass</span>
<span class="sd">in solar units: {0:.3g}</span>
<span class="sd">SI units: {1:.3g}</span>
<span class="sd">CGS units: {2:.3g}&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Msun</span><span class="p">),</span> <span class="n">M</span><span class="o">.</span><span class="n">si</span><span class="p">,</span> <span class="n">M</span><span class="o">.</span><span class="n">cgs</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Galaxy mass
in solar units: 5.13e+05 solMass
SI units: 1.02e+36 kg
CGS units: 1.02e+39 g
</pre></div>
</div>
</div>
</div>
<p>Or, if you want the log of the mass, you can just use <code class="docutils literal notranslate"><span class="pre">np.log10</span></code> as long as the logarithm’s argument is dimensionless.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Msun</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>np.float64(5.7104736875684186)
</pre></div>
</div>
</div>
</div>
<p>However, you can’t take the log of something with units, as that is not mathematically sensible.</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">UnitConversionError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/quantity_helper/helpers.py:165,</span> in <span class="ni">helper_dimensionless_to_dimensionless</span><span class="nt">(f, unit)</span>
<span class="g g-Whitespace">    </span><span class="mi">164</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">165</span>     <span class="k">return</span> <span class="p">([</span><span class="n">get_converter</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">dimensionless_unscaled</span><span class="p">)],</span> <span class="n">dimensionless_unscaled</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">166</span> <span class="k">except</span> <span class="n">UnitsError</span><span class="p">:</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/quantity_helper/helpers.py:43,</span> in <span class="ni">get_converter</span><span class="nt">(from_unit, to_unit)</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">43</span>     <span class="n">converter</span> <span class="o">=</span> <span class="n">from_unit</span><span class="o">.</span><span class="n">get_converter</span><span class="p">(</span><span class="n">to_unit</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">44</span> <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span>     <span class="c1"># Check for lack of unit only now, to avoid delay for cases where a unit</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span>     <span class="c1"># was present. Note that cases where dimensionless is expected are</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span>     <span class="c1"># already short-circuited; here, we cover just the case where, e.g., the</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span>     <span class="c1"># user has done u.add_enabled_equivalencies(u.dimensionless_angles()).</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/core.py:581,</span> in <span class="ni">UnitBase.get_converter</span><span class="nt">(self, other, equivalencies)</span>
<span class="g g-Whitespace">    </span><span class="mi">579</span>                 <span class="k">return</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">b</span><span class="p">(</span><span class="n">converter</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
<span class="ne">--&gt; </span><span class="mi">581</span> <span class="k">raise</span> <span class="n">exc</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/core.py:564,</span> in <span class="ni">UnitBase.get_converter</span><span class="nt">(self, other, equivalencies)</span>
<span class="g g-Whitespace">    </span><span class="mi">563</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">564</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_equivalencies</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">565</span>         <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_equivalencies</span><span class="p">(</span><span class="n">equivalencies</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">566</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">567</span> <span class="k">except</span> <span class="n">UnitsError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">568</span>     <span class="c1"># Last hope: maybe other knows how to do it?</span>
<span class="g g-Whitespace">    </span><span class="mi">569</span>     <span class="c1"># We assume the equivalencies have the unit itself as first item.</span>
<span class="g g-Whitespace">    </span><span class="mi">570</span>     <span class="c1"># TODO: maybe better for other to have a `_back_converter` method?</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/core.py:515,</span> in <span class="ni">UnitBase._apply_equivalencies</span><span class="nt">(self, unit, other, equivalencies)</span>
<span class="g g-Whitespace">    </span><span class="mi">513</span> <span class="n">other_str</span> <span class="o">=</span> <span class="n">get_err_str</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">515</span> <span class="k">raise</span> <span class="n">UnitConversionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">unit_str</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">other_str</span><span class="si">}</span><span class="s2"> are not convertible&quot;</span><span class="p">)</span>

<span class="ne">UnitConversionError</span>: &#39;km2 kg pc / m3&#39; (mass) and &#39;&#39; (dimensionless) are not convertible

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">UnitTypeError</span><span class="g g-Whitespace">                             </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">19</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/quantity.py:678,</span> in <span class="ni">Quantity.__array_ufunc__</span><span class="nt">(self, function, method, *inputs, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">676</span>     <span class="k">return</span> <span class="bp">NotImplemented</span>
<span class="g g-Whitespace">    </span><span class="mi">677</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">678</span>     <span class="k">raise</span> <span class="n">e</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/quantity.py:623,</span> in <span class="ni">Quantity.__array_ufunc__</span><span class="nt">(self, function, method, *inputs, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">618</span> <span class="c1"># Determine required conversion functions -- to bring the unit of the</span>
<span class="g g-Whitespace">    </span><span class="mi">619</span> <span class="c1"># input to that expected (e.g., radian for np.sin), or to get</span>
<span class="g g-Whitespace">    </span><span class="mi">620</span> <span class="c1"># consistent units between two inputs (e.g., in np.add) --</span>
<span class="g g-Whitespace">    </span><span class="mi">621</span> <span class="c1"># and the unit of the result (or tuple of units for nout &gt; 1).</span>
<span class="g g-Whitespace">    </span><span class="mi">622</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">623</span>     <span class="n">converters</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">converters_and_unit</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">625</span>     <span class="n">out</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;out&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">626</span>     <span class="c1"># Avoid loop back by turning any Quantity output into array views.</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/quantity_helper/converters.py:177,</span> in <span class="ni">converters_and_unit</span><span class="nt">(function, method, *args)</span>
<span class="g g-Whitespace">    </span><span class="mi">174</span> <span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">176</span> <span class="c1"># Determine possible conversion functions, and the result unit.</span>
<span class="ne">--&gt; </span><span class="mi">177</span> <span class="n">converters</span><span class="p">,</span> <span class="n">result_unit</span> <span class="o">=</span> <span class="n">ufunc_helper</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="o">*</span><span class="n">units</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">179</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">converter</span> <span class="ow">is</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">converter</span> <span class="ow">in</span> <span class="n">converters</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">180</span>     <span class="c1"># for multi-argument ufuncs with a quantity and a non-quantity,</span>
<span class="g g-Whitespace">    </span><span class="mi">181</span>     <span class="c1"># the quantity normally needs to be dimensionless, *except*</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>    <span class="mi">184</span>     <span class="c1"># can just have the unit of the quantity</span>
<span class="g g-Whitespace">    </span><span class="mi">185</span>     <span class="c1"># (this allows, e.g., `q &gt; 0.` independent of unit)</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span>     <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">187</span>         <span class="c1"># Don&#39;t fold this loop in the test above: this rare case</span>
<span class="g g-Whitespace">    </span><span class="mi">188</span>         <span class="c1"># should not make the common case slower.</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/quantity_helper/helpers.py:167,</span> in <span class="ni">helper_dimensionless_to_dimensionless</span><span class="nt">(f, unit)</span>
<span class="g g-Whitespace">    </span><span class="mi">165</span>     <span class="k">return</span> <span class="p">([</span><span class="n">get_converter</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">dimensionless_unscaled</span><span class="p">)],</span> <span class="n">dimensionless_unscaled</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">166</span> <span class="k">except</span> <span class="n">UnitsError</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">167</span>     <span class="k">raise</span> <span class="n">UnitTypeError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">168</span>         <span class="sa">f</span><span class="s2">&quot;Can only apply &#39;</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; function to dimensionless quantities&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">169</span>     <span class="p">)</span>

<span class="ne">UnitTypeError</span>: Can only apply &#39;log10&#39; function to dimensionless quantities
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<p>Use <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> and Kepler’s law in the form given below to determine the (circular) orbital speed of the Earth around the sun in km/s. No need to look up constants or conversion factors to do this calculation – it’s all in <code class="docutils literal notranslate"><span class="pre">astropy.units</span></code> and <code class="docutils literal notranslate"><span class="pre">astropy.constants</span></code>.</p>
<div class="math notranslate nohighlight">
\[v = \sqrt{\frac{G M_{\odot}}{r}}\]</div>
<p>There’s a much easier way to figure out the velocity of the Earth using just two units or quantities.  Do that and then compare to the Kepler’s law answer (the easiest way is probably to compute the percentage difference, if any).</p>
<p>(Completely optional, but a good way to convince yourself of the value of Quantity:) Do the above calculations by hand – you can use a calculator (or python just for its arithmatic) but look up all the appropriate conversion factors and use paper-and-pencil approaches for keeping track of them all.  Which one took longer?</p>
</section>
<section id="molecular-cloud-mass">
<h2>2. Molecular cloud mass<a class="headerlink" href="#molecular-cloud-mass" title="Link to this heading">#</a></h2>
<p>In this second example, we will demonstrate how using <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects can facilitate a full derivation of the total mass of a molecular cloud using radio observations of isotopes of Carbon Monoxide (CO).</p>
<section id="setting-up-the-data-cube">
<h3>Setting up the data cube<a class="headerlink" href="#setting-up-the-data-cube" title="Link to this heading">#</a></h3>
<p>Let’s assume that we’ve mapped the inner part of a molecular cloud in the J=1-0 rotational transition of <span class="math notranslate nohighlight">\({\rm C}^{18}{\rm O}\)</span>  and are interested in measuring its total mass. The measurement produced a data cube with RA and Dec as spatial coordiates and velocity as the third axis. Each voxel in this data cube represents the brightness temperature of the emission at that position and velocity. Furthermore, we’ll assume that we have an independent measurement of distance to the cloud <span class="math notranslate nohighlight">\(d=250\)</span> pc and that the excitation temperature is known and constant throughout the cloud: <span class="math notranslate nohighlight">\(T_{ex}=25\)</span> K.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="mi">250</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pc</span>
<span class="n">Tex</span> <span class="o">=</span> <span class="mi">25</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll generate a synthetic dataset, assuming the cloud follows a Gaussian distribution in each of RA, Dec and velocity. We start by creating a 100x100x300 numpy array, such that the first coordinate is right ascension, the second is declination, and the third is velocity.  We use the <code class="docutils literal notranslate"><span class="pre">numpy.meshgrid</span></code> function to create data cubes for each of the three coordinates, and then use them in the formula for a Gaussian to generate an array with the synthetic data cube. In this cube, the cloud is positioned at the center of the cube, with <span class="math notranslate nohighlight">\(\sigma\)</span> and the center in each dimension shown below.  Note in particular that the <span class="math notranslate nohighlight">\(\sigma\)</span> for RA and Dec have different units from the center, but <code class="docutils literal notranslate"><span class="pre">astropy</span></code> automatically does the relevant conversions before computing the exponential.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cloud&#39;s center</span>
<span class="n">cen_ra</span> <span class="o">=</span> <span class="mf">52.25</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>
<span class="n">cen_dec</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>
<span class="n">cen_v</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>

<span class="c1"># Cloud&#39;s size</span>
<span class="n">sig_ra</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcmin</span>
<span class="n">sig_dec</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcmin</span>
<span class="n">sig_v</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>

<span class="c1"># 1D coordinate quantities</span>
<span class="n">ra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">52</span><span class="p">,</span> <span class="mf">52.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>
<span class="n">dec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>

<span class="c1"># this creates data cubes of size for each coordinate based on the dimensions of the other coordinates</span>
<span class="n">ra_cube</span><span class="p">,</span> <span class="n">dec_cube</span><span class="p">,</span> <span class="n">v_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

<span class="n">data_gauss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
    <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">ra_cube</span> <span class="o">-</span> <span class="n">cen_ra</span><span class="p">)</span> <span class="o">/</span> <span class="n">sig_ra</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="o">+</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">dec_cube</span> <span class="o">-</span> <span class="n">cen_dec</span><span class="p">)</span> <span class="o">/</span> <span class="n">sig_dec</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="o">+</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">v_cube</span> <span class="o">-</span> <span class="n">cen_v</span><span class="p">)</span> <span class="o">/</span> <span class="n">sig_v</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The units of the exponential are dimensionless, so we multiply the data cube by K to get brightness temperature units. Radio astronomers use a rather odd set of units [K km/s] as of integrated intensity (that is, summing all the emission from a line over velocity). As an aside for experts, we’re setting up our artificial cube on the main-beam temperature scale (T<span class="math notranslate nohighlight">\(_{\rm MB}\)</span>) which is the closest we can normally get to the actual brightness temperature of our source.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data_gauss</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span>
</pre></div>
</div>
</div>
</div>
<p>We will also need to know the width of each velocity bin and the size of each pixel, so let’s calculate that now.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Average pixel size</span>
<span class="c1"># This is only right if dec ~ 0, because of the cos(dec) factor.</span>
<span class="n">dra</span> <span class="o">=</span> <span class="p">(</span><span class="n">ra</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">ra</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span>
<span class="n">ddec</span> <span class="o">=</span> <span class="p">(</span><span class="n">dec</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">dec</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>

<span class="c1"># Average velocity bin width</span>
<span class="n">dv</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">v</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;dra = {0}</span>
<span class="sd">ddec = {1}</span>
<span class="sd">dv = {2}&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dra</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">),</span> <span class="n">ddec</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">arcsec</span><span class="p">),</span> <span class="n">dv</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dra = 18.0 arcsec
ddec = 18.0 arcsec
dv = 0.1 km / s
</pre></div>
</div>
</div>
</div>
<p>We’re interested in the integrated intensity over all of the velocity channels, so let’s create a 2D quantity array by summing our data cube along the velocity axis (multiplying by the velocity width of a pixel).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">intcloud</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span> <span class="o">*</span> <span class="n">dv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">intcloud</span><span class="o">.</span><span class="n">unit</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\mathrm{\frac{K\,km}{s}}\]</div>
</div>
</div>
<p>We can plot the 2D quantity using matplotlib’s imshow function, by passing the quantity’s value. Similarly, we can set the correct extent using the values of <span class="math notranslate nohighlight">\(x_i\)</span> and <span class="math notranslate nohighlight">\(x_f\)</span>. Finally, we can set the colorbar label to have proper units.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note that we display RA in the convential way by going from max to min</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">intcloud</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span>
    <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">ra</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">ra</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">dec</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">dec</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;hot&quot;</span><span class="p">,</span>
    <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Intensity (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intcloud</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;RA (deg)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Dec (deg)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7413c9c308a10643dded90d91ecb604af17984df4c209796a38defede716b0ad.png" src="_images/7413c9c308a10643dded90d91ecb604af17984df4c209796a38defede716b0ad.png" />
</div>
</div>
</section>
<section id="measuring-the-column-density-of-co">
<h3>Measuring The Column Density of CO<a class="headerlink" href="#measuring-the-column-density-of-co" title="Link to this heading">#</a></h3>
<p>In order to calculate the mass of the molecular cloud, we need to measure its column density. A number of assumptions are required for the following calculation; the most important are that the emission is optically thin (typically true for <span class="math notranslate nohighlight">\({\rm C}^{18}{\rm O}\)</span>) and that conditions of local thermodynamic equilibrium hold along the line of sight. In the case where the temperature is large compared to the separation in energy levels for a molecule and the source fills the main beam of the telescope, the total column density for <span class="math notranslate nohighlight">\({\rm C}^{13}{\rm O}\)</span> is</p>
<p><span class="math notranslate nohighlight">\(N=C \frac{\int T_B(V) dV}{1-e^{-B}}\)</span></p>
<p>where the constants <span class="math notranslate nohighlight">\(C\)</span> and <span class="math notranslate nohighlight">\(B\)</span> are given by:</p>
<p><span class="math notranslate nohighlight">\(C=3.0\times10^{14} \left(\frac{\nu}{\nu_{13}}\right)^2 \frac{A_{13}}{A} {\rm K^{-1} cm^{-2} \, km^{-1} \, s}\)</span></p>
<p><span class="math notranslate nohighlight">\(B=\frac{h\nu}{k_B T}\)</span></p>
<p>(Rohlfs &amp; Wilson <a class="reference external" href="https://www.springer.com/gp/book/9783662053942">Tools for Radio Astronomy</a>).</p>
<p>Here we have given an expression for <span class="math notranslate nohighlight">\(C\)</span> scaled to the values for <span class="math notranslate nohighlight">\({\rm C}^{13}{\rm O}\)</span> (<span class="math notranslate nohighlight">\(\nu_{13}\)</span> and <span class="math notranslate nohighlight">\(A_{13}\)</span>). In order to use this relation for <span class="math notranslate nohighlight">\({\rm C}^{18}{\rm O}\)</span>, we need to rescale the frequencies <span class="math notranslate nohighlight">\({\nu}\)</span> and Einstein coefficients <span class="math notranslate nohighlight">\(A\)</span>. <span class="math notranslate nohighlight">\(C\)</span> is in funny mixed units, but that’s okay. We’ll define it as a <code class="docutils literal notranslate"><span class="pre">Quantities</span></code> object and not have to worry about it.</p>
<p>First, we look up the wavelength for these emission lines and store them as quantities.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lambda13</span> <span class="o">=</span> <span class="mf">2.60076</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mm</span>
<span class="n">lambda18</span> <span class="o">=</span> <span class="mf">2.73079</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mm</span>
</pre></div>
</div>
</div>
</div>
<p>Since the wavelength and frequency of light are related using the speed of light, we can convert between them. However, doing so just using the <code class="docutils literal notranslate"><span class="pre">to()</span></code> method fails, as units of length and frequency are not convertible:</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nu13</span> <span class="o">=</span> <span class="n">lambda13</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Hz</span><span class="p">)</span>
<span class="n">nu18</span> <span class="o">=</span> <span class="n">lambda18</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Hz</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">UnitConversionError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">27</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">nu13</span> <span class="o">=</span> <span class="n">lambda13</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Hz</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">nu18</span> <span class="o">=</span> <span class="n">lambda18</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Hz</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/quantity.py:925,</span> in <span class="ni">Quantity.to</span><span class="nt">(self, unit, equivalencies, copy)</span>
<span class="g g-Whitespace">    </span><span class="mi">921</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">922</span> <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">923</span>     <span class="c1"># Avoid using to_value to ensure that we make a copy. We also</span>
<span class="g g-Whitespace">    </span><span class="mi">924</span>     <span class="c1"># don&#39;t want to slow down this method (esp. the scalar case).</span>
<span class="ne">--&gt; </span><span class="mi">925</span>     <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_value</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">equivalencies</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">926</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">927</span>     <span class="c1"># to_value only copies if necessary</span>
<span class="g g-Whitespace">    </span><span class="mi">928</span>     <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">equivalencies</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/quantity.py:878,</span> in <span class="ni">Quantity._to_value</span><span class="nt">(self, unit, equivalencies)</span>
<span class="g g-Whitespace">    </span><span class="mi">875</span>     <span class="n">equivalencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_equivalencies</span>
<span class="g g-Whitespace">    </span><span class="mi">876</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">StructuredUnit</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">877</span>     <span class="c1"># Standard path, let unit to do work.</span>
<span class="ne">--&gt; </span><span class="mi">878</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">to</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">879</span>         <span class="n">unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="n">equivalencies</span><span class="o">=</span><span class="n">equivalencies</span>
<span class="g g-Whitespace">    </span><span class="mi">880</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">882</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">883</span>     <span class="c1"># The .to() method of a simple unit cannot convert a structured</span>
<span class="g g-Whitespace">    </span><span class="mi">884</span>     <span class="c1"># dtype, so we work around it, by recursing.</span>
<span class="g g-Whitespace">    </span><span class="mi">885</span>     <span class="c1"># TODO: deprecate this?</span>
<span class="g g-Whitespace">    </span><span class="mi">886</span>     <span class="c1"># Convert simple to Structured on initialization?</span>
<span class="g g-Whitespace">    </span><span class="mi">887</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/core.py:652,</span> in <span class="ni">UnitBase.to</span><span class="nt">(self, other, value, equivalencies)</span>
<span class="g g-Whitespace">    </span><span class="mi">650</span>     <span class="k">return</span> <span class="n">UNITY</span>
<span class="g g-Whitespace">    </span><span class="mi">651</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">652</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_converter</span><span class="p">(</span><span class="n">Unit</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="n">equivalencies</span><span class="p">)(</span><span class="n">value</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/core.py:581,</span> in <span class="ni">UnitBase.get_converter</span><span class="nt">(self, other, equivalencies)</span>
<span class="g g-Whitespace">    </span><span class="mi">578</span>             <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">579</span>                 <span class="k">return</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">b</span><span class="p">(</span><span class="n">converter</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
<span class="ne">--&gt; </span><span class="mi">581</span> <span class="k">raise</span> <span class="n">exc</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/core.py:564,</span> in <span class="ni">UnitBase.get_converter</span><span class="nt">(self, other, equivalencies)</span>
<span class="g g-Whitespace">    </span><span class="mi">562</span> <span class="c1"># if that doesn&#39;t work, maybe we can do it with equivalencies?</span>
<span class="g g-Whitespace">    </span><span class="mi">563</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">564</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_equivalencies</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">565</span>         <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_equivalencies</span><span class="p">(</span><span class="n">equivalencies</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">566</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">567</span> <span class="k">except</span> <span class="n">UnitsError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">568</span>     <span class="c1"># Last hope: maybe other knows how to do it?</span>
<span class="g g-Whitespace">    </span><span class="mi">569</span>     <span class="c1"># We assume the equivalencies have the unit itself as first item.</span>
<span class="g g-Whitespace">    </span><span class="mi">570</span>     <span class="c1"># TODO: maybe better for other to have a `_back_converter` method?</span>
<span class="g g-Whitespace">    </span><span class="mi">571</span>     <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;equivalencies&quot;</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/core.py:515,</span> in <span class="ni">UnitBase._apply_equivalencies</span><span class="nt">(self, unit, other, equivalencies)</span>
<span class="g g-Whitespace">    </span><span class="mi">512</span> <span class="n">unit_str</span> <span class="o">=</span> <span class="n">get_err_str</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">513</span> <span class="n">other_str</span> <span class="o">=</span> <span class="n">get_err_str</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">515</span> <span class="k">raise</span> <span class="n">UnitConversionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">unit_str</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">other_str</span><span class="si">}</span><span class="s2"> are not convertible&quot;</span><span class="p">)</span>

<span class="ne">UnitConversionError</span>: &#39;mm&#39; (length) and &#39;Hz&#39; (frequency) are not convertible
</pre></div>
</div>
</div>
</div>
<p>Fortunately, <code class="docutils literal notranslate"><span class="pre">astropy</span></code> comes to the rescue by providing a feature called “unit equivalencies.”  Equivalencies provide a way to convert between two physically different units that are not normally equivalent, but in a certain context have a one-to-one mapping.  For more on equivalencies, see the <a class="reference external" href="http://docs.astropy.org/en/stable/units/equivalencies.html">equivalencies section of astropy’s documentation</a>.</p>
<p>In this case, calling the <code class="docutils literal notranslate"><span class="pre">astropy.units.spectral()</span></code> function provides the equivalencies necessary to handle conversions between wavelength and frequency. To use it, provide the equivalencies to the <code class="docutils literal notranslate"><span class="pre">equivalencies</span></code> keyword of the <code class="docutils literal notranslate"><span class="pre">to()</span></code> call:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nu13</span> <span class="o">=</span> <span class="n">lambda13</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Hz</span><span class="p">,</span> <span class="n">equivalencies</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">spectral</span><span class="p">())</span>
<span class="n">nu18</span> <span class="o">=</span> <span class="n">lambda18</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Hz</span><span class="p">,</span> <span class="n">equivalencies</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">spectral</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we look up Einstein coefficients (in units of s<span class="math notranslate nohighlight">\(^{-1}\)</span>), and calculate the ratios in constant <span class="math notranslate nohighlight">\(C\)</span>. Note how the ratios of frequency and Einstein coefficient units are dimensionless, so the unit of <span class="math notranslate nohighlight">\(C\)</span> is unchanged.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nu13</span> <span class="o">=</span> <span class="mf">115271096910.13396</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Hz</span>
<span class="n">nu18</span> <span class="o">=</span> <span class="mf">109782318669.689</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Hz</span>
<span class="n">A13</span> <span class="o">=</span> <span class="mf">7.4e-8</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>
<span class="n">A18</span> <span class="o">=</span> <span class="mf">8.8e-8</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span>

<span class="n">C</span> <span class="o">=</span> <span class="mf">3e14</span> <span class="o">*</span> <span class="p">(</span><span class="n">nu18</span> <span class="o">/</span> <span class="n">nu13</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">A13</span> <span class="o">/</span> <span class="n">A18</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">K</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">km</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">))</span>
<span class="n">C</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[2.1792458 \times 10^{14} \; \mathrm{\frac{s}{K\,km\,cm^{2}}}\]</div>
</div>
</div>
<p>Now we move on to calculate the constant <span class="math notranslate nohighlight">\(B\)</span>. This is given by the ratio of <span class="math notranslate nohighlight">\(\frac{h\nu}{k_B T}\)</span>, where <span class="math notranslate nohighlight">\(h\)</span> is Planck’s constant, <span class="math notranslate nohighlight">\(k_B\)</span> is the Boltzmann’s constant, <span class="math notranslate nohighlight">\(\nu\)</span> is the emission frequency, and <span class="math notranslate nohighlight">\(T\)</span> is the excitation temperature. The constants were imported from <code class="docutils literal notranslate"><span class="pre">astropy.constants</span></code>, and the other two values are already calculated, so here we just take the ratio.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">B</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">nu18</span> <span class="o">/</span> <span class="p">(</span><span class="n">k_B</span> <span class="o">*</span> <span class="n">Tex</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The units of <span class="math notranslate nohighlight">\(B\)</span> are Hz sec, which can be decomposed to a dimensionless unit if you actually care about its value.  Usually this is not necessary, though. Quantities are at their best if you use them without worrying about intermediate units, and only convert at the very end when you want a final answer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="se">\n</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">decompose</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.21074881298143522 Hz s
0.21074881298143522
</pre></div>
</div>
</div>
</div>
<p>At this point we have all the ingredients to calculate the number density of <span class="math notranslate nohighlight">\(\rm CO\)</span> molecules in this cloud. We already integrated (summed) over the velocity channels above to show the integrated intensity map, but we’ll do it again here for clarity. This gives us the column density of CO for each spatial pixel in our map. We can then print out the peak column column density.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">NCO</span> <span class="o">=</span> <span class="n">C</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span> <span class="o">*</span> <span class="n">dv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Peak CO column density: &quot;</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">NCO</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Peak CO column density: 
</pre></div>
</div>
<div class="output text_latex math notranslate nohighlight">
\[8.5782091 \times 10^{15} \; \mathrm{\frac{1}{cm^{2}}}\]</div>
</div>
</div>
</section>
<section id="co-to-total-mass">
<h3>CO to Total Mass<a class="headerlink" href="#co-to-total-mass" title="Link to this heading">#</a></h3>
<p>We are using CO as a tracer for the much more numerous H<span class="math notranslate nohighlight">\(_2\)</span>, the quantity we are actually trying to infer. Since most of the mass is in H<span class="math notranslate nohighlight">\(_2\)</span>, we calculate its column density by multiplying the CO column density with the (known/assumed) H<span class="math notranslate nohighlight">\(_2\)</span>/CO ratio.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">H2_CO_ratio</span> <span class="o">=</span> <span class="mf">5.9e6</span>
<span class="n">NH2</span> <span class="o">=</span> <span class="n">NCO</span> <span class="o">*</span> <span class="n">H2_CO_ratio</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Peak H2 column density: &quot;</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">NH2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Peak H2 column density: 
</pre></div>
</div>
<div class="output text_latex math notranslate nohighlight">
\[5.0611434 \times 10^{22} \; \mathrm{\frac{1}{cm^{2}}}\]</div>
</div>
</div>
<p>That’s a peak column density of roughly 50 magnitudes of visual extinction (assuming the conversion between N<span class="math notranslate nohighlight">\(_{\rm H_2}\)</span> and A<span class="math notranslate nohighlight">\(_V\)</span> from Bohlin et al. 1978), which seems reasonable for a molecular cloud.</p>
<p>We obtain the mass column density by multiplying the number column density by the mass of an individual H<span class="math notranslate nohighlight">\(_2\)</span> molecule.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mH2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">1.008</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Dalton</span>  <span class="c1"># aka atomic mass unit/amu</span>
<span class="n">rho</span> <span class="o">=</span> <span class="n">NH2</span> <span class="o">*</span> <span class="n">mH2</span>
</pre></div>
</div>
</div>
</div>
<p>A final step in going from the column density to mass is summing up over the area area. If we do this in the straightforward way of length x width of a pixel, this area is then in units of <span class="math notranslate nohighlight">\({\rm deg}^2\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dap</span> <span class="o">=</span> <span class="n">dra</span> <span class="o">*</span> <span class="n">ddec</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dap</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.5e-05 deg2
</pre></div>
</div>
</div>
</div>
<p>Now comes an important subtlety: in the small angle approximation, multiplying the pixel area with the square of distance yields the cross-sectional area of the cloud that the pixel covers, in <em>physical</em> units, rather than angular units.  So it’s tempting to just multiply the area and the square of the distance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">da</span> <span class="o">=</span> <span class="n">dap</span> <span class="o">*</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># don&#39;t actually do it this way - use the version below instead!</span>
<span class="nb">print</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.5625 deg2 pc2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dap</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">steradian</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[0.00047596472 \; \mathrm{pc^{2}}\]</div>
</div>
</div>
<p>But this is <strong>wrong</strong>, because <code class="docutils literal notranslate"><span class="pre">astropy.units</span></code> treats angles (and solid angles) as actual physical units, while the small-angle approximation assumes angles are dimensionless.  So if you, e.g., try to convert to a different area unit, it will fail:</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">da</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">UnitConversionError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">da</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/quantity.py:925,</span> in <span class="ni">Quantity.to</span><span class="nt">(self, unit, equivalencies, copy)</span>
<span class="g g-Whitespace">    </span><span class="mi">921</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">Unit</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">922</span> <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">923</span>     <span class="c1"># Avoid using to_value to ensure that we make a copy. We also</span>
<span class="g g-Whitespace">    </span><span class="mi">924</span>     <span class="c1"># don&#39;t want to slow down this method (esp. the scalar case).</span>
<span class="ne">--&gt; </span><span class="mi">925</span>     <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_value</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">equivalencies</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">926</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">927</span>     <span class="c1"># to_value only copies if necessary</span>
<span class="g g-Whitespace">    </span><span class="mi">928</span>     <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">equivalencies</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/quantity.py:878,</span> in <span class="ni">Quantity._to_value</span><span class="nt">(self, unit, equivalencies)</span>
<span class="g g-Whitespace">    </span><span class="mi">875</span>     <span class="n">equivalencies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_equivalencies</span>
<span class="g g-Whitespace">    </span><span class="mi">876</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">StructuredUnit</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">877</span>     <span class="c1"># Standard path, let unit to do work.</span>
<span class="ne">--&gt; </span><span class="mi">878</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">to</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">879</span>         <span class="n">unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="n">equivalencies</span><span class="o">=</span><span class="n">equivalencies</span>
<span class="g g-Whitespace">    </span><span class="mi">880</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">882</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">883</span>     <span class="c1"># The .to() method of a simple unit cannot convert a structured</span>
<span class="g g-Whitespace">    </span><span class="mi">884</span>     <span class="c1"># dtype, so we work around it, by recursing.</span>
<span class="g g-Whitespace">    </span><span class="mi">885</span>     <span class="c1"># TODO: deprecate this?</span>
<span class="g g-Whitespace">    </span><span class="mi">886</span>     <span class="c1"># Convert simple to Structured on initialization?</span>
<span class="g g-Whitespace">    </span><span class="mi">887</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/core.py:652,</span> in <span class="ni">UnitBase.to</span><span class="nt">(self, other, value, equivalencies)</span>
<span class="g g-Whitespace">    </span><span class="mi">650</span>     <span class="k">return</span> <span class="n">UNITY</span>
<span class="g g-Whitespace">    </span><span class="mi">651</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">652</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_converter</span><span class="p">(</span><span class="n">Unit</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="n">equivalencies</span><span class="p">)(</span><span class="n">value</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/core.py:581,</span> in <span class="ni">UnitBase.get_converter</span><span class="nt">(self, other, equivalencies)</span>
<span class="g g-Whitespace">    </span><span class="mi">578</span>             <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">579</span>                 <span class="k">return</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">b</span><span class="p">(</span><span class="n">converter</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
<span class="ne">--&gt; </span><span class="mi">581</span> <span class="k">raise</span> <span class="n">exc</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/core.py:564,</span> in <span class="ni">UnitBase.get_converter</span><span class="nt">(self, other, equivalencies)</span>
<span class="g g-Whitespace">    </span><span class="mi">562</span> <span class="c1"># if that doesn&#39;t work, maybe we can do it with equivalencies?</span>
<span class="g g-Whitespace">    </span><span class="mi">563</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">564</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_equivalencies</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">565</span>         <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_equivalencies</span><span class="p">(</span><span class="n">equivalencies</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">566</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">567</span> <span class="k">except</span> <span class="n">UnitsError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">568</span>     <span class="c1"># Last hope: maybe other knows how to do it?</span>
<span class="g g-Whitespace">    </span><span class="mi">569</span>     <span class="c1"># We assume the equivalencies have the unit itself as first item.</span>
<span class="g g-Whitespace">    </span><span class="mi">570</span>     <span class="c1"># TODO: maybe better for other to have a `_back_converter` method?</span>
<span class="g g-Whitespace">    </span><span class="mi">571</span>     <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;equivalencies&quot;</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/core.py:515,</span> in <span class="ni">UnitBase._apply_equivalencies</span><span class="nt">(self, unit, other, equivalencies)</span>
<span class="g g-Whitespace">    </span><span class="mi">512</span> <span class="n">unit_str</span> <span class="o">=</span> <span class="n">get_err_str</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">513</span> <span class="n">other_str</span> <span class="o">=</span> <span class="n">get_err_str</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">515</span> <span class="k">raise</span> <span class="n">UnitConversionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">unit_str</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">other_str</span><span class="si">}</span><span class="s2"> are not convertible&quot;</span><span class="p">)</span>

<span class="ne">UnitConversionError</span>: &#39;deg2 pc2&#39; and &#39;cm2&#39; (area) are not convertible
</pre></div>
</div>
</div>
</div>
<p>The solution is to use the <code class="docutils literal notranslate"><span class="pre">dimensionless_angles</span></code> equivalency, which allows angles to be treated as dimensionless.  This makes it so that they will automatically convert to radians and become dimensionless when a conversion is needed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">da</span> <span class="o">=</span> <span class="p">(</span><span class="n">dap</span> <span class="o">*</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">equivalencies</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">dimensionless_angles</span><span class="p">())</span>
<span class="n">da</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[0.00047596472 \; \mathrm{pc^{2}}\]</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">da</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[4.5318534 \times 10^{33} \; \mathrm{cm^{2}}\]</div>
</div>
</div>
<p>Finally, multiplying the column density with the pixel area and summing over all the pixels gives us the cloud mass.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="n">da</span><span class="p">)</span>
<span class="n">M</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">solMass</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[317.64843 \; \mathrm{M_{\odot}}\]</div>
</div>
</div>
</section>
</section>
<section id="id1">
<h2>Exercises<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>The astro material was pretty heavy on that one, so let’s focus on some associated statistics using <code class="docutils literal notranslate"><span class="pre">Quantity</span></code>’s array capabililities. Compute the median and mean of the <code class="docutils literal notranslate"><span class="pre">data</span></code> with the <code class="docutils literal notranslate"><span class="pre">np.mean</span></code> and <code class="docutils literal notranslate"><span class="pre">np.median</span></code> functions.  Why are their values so different?</p>
<p>Similarly, compute the standard deviation and variance (if you don’t know the relevant functions, look it up in the numpy docs or just type np.<tab> and a code cell).  Do they have the units you expect?</p>
</section>
<section id="using-quantities-with-functions">
<h2>3. Using Quantities with Functions<a class="headerlink" href="#using-quantities-with-functions" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Quantity</span></code> is also a useful tool if you plan to share some of your code, either with collaborators or the wider community.  By writing functions that take <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects instead of raw numbers or arrays, you can write code that is agnostic to the input unit.  In this way, you may even be able to prevent <a class="reference external" href="http://en.wikipedia.org/wiki/Mars_Climate_Orbiter#Cause_of_failure">the destruction of Mars orbiters</a>. Below, we provide a simple example.</p>
<p>Suppose you are working on an instrument, and the person funding it asks for a function to give an analytic estimate of the response function.  You determine from some tests it’s basically a Lorentzian, but with a different scale along the two axes.  Your first thought might be to do this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">response_func</span><span class="p">(</span><span class="n">xinarcsec</span><span class="p">,</span> <span class="n">yinarcsec</span><span class="p">):</span>
    <span class="n">xscale</span> <span class="o">=</span> <span class="mf">0.9</span>
    <span class="n">yscale</span> <span class="o">=</span> <span class="mf">0.85</span>
    <span class="n">xfactor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xinarcsec</span> <span class="o">/</span> <span class="n">xscale</span><span class="p">)</span>
    <span class="n">yfactor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">yinarcsec</span> <span class="o">/</span> <span class="n">yscale</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xfactor</span> <span class="o">*</span> <span class="n">yfactor</span>
</pre></div>
</div>
</div>
</div>
<p>You meant the inputs to be in arcsec, but alas, you send that to your collaborator and they don’t look closely and think the inputs are instead supposed to be in arcmin.  So they do:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response_func</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.19640564826700893
</pre></div>
</div>
</div>
</div>
<p>And now they tell all their friends how terrible the instrument is, because it’s supposed to have arcsecond resolution, but your function clearly shows it can only resolve an arcmin at best. But you can solve this by requiring they pass in <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects.  The new function could simply be:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">response_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">xscale</span> <span class="o">=</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span>
    <span class="n">yscale</span> <span class="o">=</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span>
    <span class="n">xfactor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="n">xscale</span><span class="p">)</span>
    <span class="n">yfactor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">y</span> <span class="o">/</span> <span class="n">yscale</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xfactor</span> <span class="o">*</span> <span class="n">yfactor</span>
</pre></div>
</div>
</div>
</div>
<p>And your collaborator now has to pay attention.  If they just blindly put in a number they get an error:</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response_func</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">UnitConversionError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">45</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">response_func</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>

<span class="nn">Cell In[44], line 4,</span> in <span class="ni">response_func</span><span class="nt">(x, y)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">xscale</span> <span class="o">=</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">yscale</span> <span class="o">=</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">xfactor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="n">xscale</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">yfactor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">y</span> <span class="o">/</span> <span class="n">yscale</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="k">return</span> <span class="n">xfactor</span> <span class="o">*</span> <span class="n">yfactor</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/quantity.py:678,</span> in <span class="ni">Quantity.__array_ufunc__</span><span class="nt">(self, function, method, *inputs, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">676</span>     <span class="k">return</span> <span class="bp">NotImplemented</span>
<span class="g g-Whitespace">    </span><span class="mi">677</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">678</span>     <span class="k">raise</span> <span class="n">e</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/quantity.py:623,</span> in <span class="ni">Quantity.__array_ufunc__</span><span class="nt">(self, function, method, *inputs, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">618</span> <span class="c1"># Determine required conversion functions -- to bring the unit of the</span>
<span class="g g-Whitespace">    </span><span class="mi">619</span> <span class="c1"># input to that expected (e.g., radian for np.sin), or to get</span>
<span class="g g-Whitespace">    </span><span class="mi">620</span> <span class="c1"># consistent units between two inputs (e.g., in np.add) --</span>
<span class="g g-Whitespace">    </span><span class="mi">621</span> <span class="c1"># and the unit of the result (or tuple of units for nout &gt; 1).</span>
<span class="g g-Whitespace">    </span><span class="mi">622</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">623</span>     <span class="n">converters</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">converters_and_unit</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">625</span>     <span class="n">out</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;out&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">626</span>     <span class="c1"># Avoid loop back by turning any Quantity output into array views.</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.12.11/x64/lib/python3.12/site-packages/astropy/units/quantity_helper/converters.py:195,</span> in <span class="ni">converters_and_unit</span><span class="nt">(function, method, *args)</span>
<span class="g g-Whitespace">    </span><span class="mi">193</span>             <span class="n">converters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">194</span>         <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">195</span>             <span class="k">raise</span> <span class="n">UnitConversionError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">196</span>                 <span class="sa">f</span><span class="s2">&quot;Can only apply &#39;</span><span class="si">{</span><span class="n">function</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; function to &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">197</span>                 <span class="s2">&quot;dimensionless quantities when other argument is not &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">198</span>                 <span class="s2">&quot;a quantity (unless the latter is all zero/infinity/nan).&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">199</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">200</span> <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">201</span>     <span class="c1"># _can_have_arbitrary_unit failed: arg could not be compared</span>
<span class="g g-Whitespace">    </span><span class="mi">202</span>     <span class="c1"># with zero or checked to be finite. Then, ufunc will fail too.</span>
<span class="g g-Whitespace">    </span><span class="mi">203</span>     <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">204</span>         <span class="s2">&quot;Unsupported operand type(s) for ufunc </span><span class="si">{}</span><span class="s2">: &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">205</span>             <span class="n">function</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">206</span>             <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">arg</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]),</span>
<span class="g g-Whitespace">    </span><span class="mi">207</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">208</span>     <span class="p">)</span>

<span class="ne">UnitConversionError</span>: Can only apply &#39;add&#39; function to dimensionless quantities when other argument is not a quantity (unless the latter is all zero/infinity/nan).
</pre></div>
</div>
</div>
</div>
<p>Which is their cue to provide the units explicitly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">response_func</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcmin</span><span class="p">,</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcmin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[0.0001724307 \; \mathrm{}\]</div>
</div>
</div>
<p>The funding agency is impressed at the resolution you achieved, and your instrument is saved!  You now go on to win the Nobel Prize due to discoveries the instrument makes.  And it was all because you used <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> as the input of code you shared.</p>
</section>
<section id="exercise">
<h2>Exercise<a class="headerlink" href="#exercise" title="Link to this heading">#</a></h2>
<p>Write a function that computes the Keplerian velocity you worked out in section 1 (using <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> input and outputs, of course), but allowing for an arbitrary mass and orbital radius.  Try it with some reasonable numbers for satellites orbiting the Earth, a moon of Jupiter, or an extrasolar planet.  Feel free to use wikipedia or similar for the masses and distances.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "astropy-learn/tutorial--quantities",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#authors">Authors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#keywords">Keywords</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#companion-content">Companion Content</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preliminaries">Preliminaries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#galaxy-mass">1. Galaxy mass</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#molecular-cloud-mass">2. Molecular cloud mass</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-the-data-cube">Setting up the data cube</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#measuring-the-column-density-of-co">Measuring The Column Density of CO</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#co-to-total-mass">CO to Total Mass</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Exercises</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-quantities-with-functions">3. Using Quantities with Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">Exercise</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Ana Bonaca, Erik Tollerud, Jonathan Foster, Lia Corrales, Kris Stern, Stephanie T. Douglas
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>